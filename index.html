<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>20 KÄ°ÅžÄ°YE 1K ROBUX Ã‡EKÄ°LÄ°ÅžÄ°</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet" />

  <style>
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      padding: 50px 20px;
      font-family: 'Montserrat', sans-serif;
      color: #ccc;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      overflow-x: hidden;
      position: relative;
      background: none;
      user-select: none;
    }

    /* Arkaplan GIF */
    body::before {
      content: "";
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      background: url('https://media4.giphy.com/media/v1.Y2lkPTc5MGI3NjExbDI0cHR5YnV5d25sdGRoMTZiN3lpZDFnNXAwOGlucTA5bW8zZWl3dCZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/TrVla4Z2PYEkU/giphy.gif') no-repeat center center/cover;
      filter: brightness(0.4) saturate(0.85);
      z-index: -2;
      will-change: transform;
      animation: subtleMove 30s ease-in-out infinite alternate;
      pointer-events: none;
    }

    /* Koyu yarÄ± saydam katman */
    body::after {
      content: "";
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      background: rgba(10,10,10,0.85);
      z-index: -1;
      pointer-events: none;
    }

    @keyframes subtleMove {
      0% { transform: scale(1) translate(0,0); }
      100% { transform: scale(1.03) translate(10px,10px); }
    }

    @keyframes floatUp {
      0% {
        opacity: 0;
        transform: translateY(15px);
      }
      50% {
        opacity: 1;
        transform: translateY(0);
      }
      100% {
        opacity: 0;
        transform: translateY(-20px);
      }
    }

    h1 {
      font-weight: 900;
      font-size: 3rem;
      color: #ddd;
      margin-bottom: 12px;
      text-transform: uppercase;
      letter-spacing: 3px;
      text-align: center;
      text-shadow:
        0 0 8px #0008,
        0 0 15px #000c;
    }

    p.lead {
      max-width: 480px;
      text-align: center;
      color: #bbb;
      font-weight: 600;
      font-size: 1.25rem;
      margin-bottom: 40px;
      text-shadow: 0 0 6px #0009;
    }

    .container {
      background: rgba(20, 20, 20, 0.9);
      padding: 35px 40px;
      border-radius: 16px;
      max-width: 480px;
      width: 100%;
      box-shadow:
        0 0 30px #000c,
        inset 0 0 12px #111a;
      position: relative;
      z-index: 1;
      backdrop-filter: saturate(150%) blur(10px);
      border: 1px solid #222;
    }

    label {
      display: block;
      font-weight: 700;
      margin-bottom: 12px;
      color: #ddd;
    }

    input[type="text"] {
      width: 100%;
      padding: 16px 20px;
      font-size: 17px;
      border-radius: 14px;
      border: 2px solid #444;
      background: #222a2e;
      color: #eee;
      outline: none !important;
      transition: border-color 0.3s ease, box-shadow 0.3s ease;
      box-shadow: inset 0 0 6px #111;
      backdrop-filter: blur(3px);
    }
    input[type="text"]:focus {
      border-color: #88cc88;
      box-shadow: 0 0 14px #66aa66aa;
      background: #2e3b2e;
    }

    button {
      width: 100%;
      padding: 18px 0;
      margin-top: 28px;
      font-size: 18px;
      font-weight: 800;
      color: #121212;
      background: linear-gradient(90deg, #88cc88, #aaddaa);
      border: none;
      border-radius: 16px;
      cursor: pointer;
      box-shadow:
        0 0 20px #8ef08eaa,
        inset 0 0 6px #77bb77;
      transition: background 0.4s ease, box-shadow 0.4s ease;
      user-select: none;
    }
    button:hover:enabled {
      background: linear-gradient(90deg, #a1dca1, #c4f0c4);
      box-shadow: 0 0 30px #a5f3a5ee;
    }
    button:disabled {
      background: #555;
      cursor: not-allowed;
      box-shadow: none;
      color: #bbb;
    }

    .error {
      color: #ff7070;
      margin-top: 18px;
      font-weight: 700;
      text-shadow: 0 0 4px #700000aa;
      user-select: none;
    }

    .info {
      margin-top: 22px;
      font-size: 16px;
      font-weight: 700;
      color: #7fe27f;
      text-shadow:
        0 0 10px #4caf5088,
        0 0 25px #4caf5033;
      animation: floatUp 2.5s ease forwards;
      pointer-events: none;
      min-height: 26px;
      display: inline-block;
      user-select: none;
    }

    /* Åžartlar kutusu */
    .terms {
      margin-top: 36px;
      background: rgba(12, 12, 12, 0.9);
      border-radius: 16px;
      padding: 22px 25px;
      font-size: 14px;
      line-height: 1.55;
      color: #bbb;
      box-shadow: 0 0 12px #000c;
      backdrop-filter: blur(6px);
      border: 1px solid #222;
      user-select: none;
      position: relative;
    }

    .terms ul {
      list-style: none;
      padding-left: 20px;
      margin: 12px 0 0 0;
    }

    .terms li {
      position: relative;
      margin-bottom: 14px;
      padding-left: 28px;
      font-weight: 600;
      color: #ccc;
    }

    /* âœ“ simgesi koyduk, emoji yok */
    .terms li::before {
      content: "âœ“";
      position: absolute;
      left: 0;
      top: 50%;
      transform: translateY(-50%);
      color: #6fa16f;
      font-weight: 900;
      font-size: 18px;
      text-shadow: none;
    }

    /* Linkler */
    .term-link {
      color: #88cc88;
      text-decoration: none;
      border-bottom: 1.5px solid transparent;
      transition: border-color 0.25s ease, color 0.25s ease;
      user-select: text;
    }
    .term-link:hover {
      color: #bbffbb;
      border-color: #bbffbb;
    }

    /* KatÄ±lanlar kutusu */
    .participants {
      margin-top: 50px;
      max-height: 280px;
      overflow-y: auto;
      background: rgba(15,15,15,0.9);
      border-radius: 16px;
      padding: 18px 22px;
      font-size: 14px;
      box-shadow:
        0 0 20px #000a,
        inset 0 0 12px #111111cc;
      user-select: none;
      position: relative;
      z-index: 1;
      backdrop-filter: saturate(150%) blur(7px);
      border: 1px solid #222;
      color: #ddd;
    }

    .participants h2 {
      margin-top: 0;
      margin-bottom: 18px;
      font-weight: 700;
      color: #eee;
      text-shadow: 0 0 6px #000000cc;
    }

    .participant {
      display: flex;
      align-items: center;
      padding: 10px 14px;
      border-bottom: 1px solid #222;
      transition: background 0.25s ease;
    }

    .participant:hover {
      background: rgba(50, 90, 50, 0.15);
    }

    .participant:last-child {
      border-bottom: none;
    }

    .avatar-initial {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: #335533;
      color: #cceccc;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 900;
      font-size: 15px;
      margin-right: 16px;
      border: 1.5px solid #558855;
      text-transform: uppercase;
      box-shadow: 0 0 5px #114411aa inset;
      user-select: none;
    }

    /* Scrollbar stil */
    .participants::-webkit-scrollbar {
      width: 8px;
    }
    .participants::-webkit-scrollbar-track {
      background: #111;
      border-radius: 8px;
    }
    .participants::-webkit-scrollbar-thumb {
      background: #557755;
      border-radius: 8px;
    }
  </style>
</head>
<body>

  <h1>20 KÄ°ÅžÄ°YE 1K ROBUX</h1>
  <p class="lead">Toplam 20 ÅŸanslÄ± katÄ±lÄ±mcÄ± 1000 Robux kazanacak! Åžimdi katÄ±l, ÅŸansÄ±nÄ± gÃ¶ster! ðŸš€</p>

  <div class="container">
    <form id="raffleForm" autocomplete="off" novalidate>
      <label for="username">Roblox KullanÄ±cÄ± AdÄ±nÄ±z:</label>
      <input
        type="text"
        id="username"
        name="username"
        placeholder="Ã–rnek: MarksBlade"
        required
        minlength="3"
        maxlength="20"
        pattern="^[a-zA-Z0-9_]+$"
        aria-describedby="usernameHelp"
        aria-invalid="false"
      />

      <div class="terms" role="region" aria-labelledby="termsHeading" tabindex="0">
        <p id="termsHeading" style="font-weight: 700; margin-bottom: 12px; color: #aaa;">Ã‡ekiliÅŸe katÄ±lmak iÃ§in aÅŸaÄŸÄ±daki adÄ±mlarÄ± tamamla:</p>
        <ul>
          <li><a class="term-link" href="https://www.roblox.com/users/1665776490/profile" target="_blank" rel="noopener noreferrer">Beni takip et â†’ Roblox Profilim</a></li>
          <li><a class="term-link" href="https://www.roblox.com/communities/35669821/Marks-Blade#!/about" target="_blank" rel="noopener noreferrer">Gruba katÄ±l â†’ Marks Blade Grubu</a></li>
          <li><a class="term-link" href="https://www.roblox.com/games/127031268866383/UPDATE" target="_blank" rel="noopener noreferrer">Oyunu beÄŸen &amp; favorilere ekle â†’ Roblox Oyunu</a></li>
          <li><strong>Her IP adresinden sadece 1 katÄ±lÄ±m yapÄ±labilir.</strong></li>
          <li><strong>Toplamda 20 kiÅŸi rastgele seÃ§ilecektir.</strong></li>
        </ul>
      </div>

      <button type="submit" id="submitBtn">Ã‡ekiliÅŸe KatÄ±l</button>
      <div class="error" id="errorMsg" role="alert" aria-live="assertive" style="display:none;"></div>
      <div class="info" id="infoMsg" aria-live="polite"></div>
    </form>

    <div class="participants" aria-live="polite" aria-atomic="true">
      <h2>KatÄ±lanlar</h2>
      <div id="participantList">YÃ¼kleniyor...</div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import { getDatabase, ref, get, set, push, onValue } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCaPAQ8sHlRdE3cuJSYokb9b-rWi_F0Ei8",
      authDomain: "marksbladebuyukcekilis.firebaseapp.com",
      databaseURL: "https://marksbladebuyukcekilis-default-rtdb.firebaseio.com",
      projectId: "marksbladebuyukcekilis",
      storageBucket: "marksbladebuyukcekilis.firebasestorage.app",
      messagingSenderId: "403809139259",
      appId: "1:403809139259:web:03b758ff825039e662ba1e",
      measurementId: "G-XNSYXYSEEW"
    };

    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);

    const raffleForm = document.getElementById('raffleForm');
    const usernameInput = document.getElementById('username');
    const submitBtn = document.getElementById('submitBtn');
    const errorMsg = document.getElementById('errorMsg');
    const infoMsg = document.getElementById('infoMsg');
    const participantList = document.getElementById('participantList');

    async function getUserIP() {
      try {
        const res = await fetch('https://api.ipify.org?format=json');
        const data = await res.json();
        return data.ip;
      } catch {
        return null;
      }
    }

    function listenParticipants() {
      const participantsRef = ref(database, 'participants');
      onValue(participantsRef, (snapshot) => {
        const data = snapshot.val();
        participantList.innerHTML = '';
        if (!data) {
          participantList.innerHTML = '<p>HenÃ¼z katÄ±lÄ±m yok.</p>';
          return;
        }
        const entries = Object.values(data);
        entries.forEach(({ username }) => {
          const div = document.createElement('div');
          div.classList.add('participant');

          const initial = document.createElement('div');
          initial.classList.add('avatar-initial');
          initial.textContent = username.charAt(0).toUpperCase();

          const name = document.createElement('span');
          name.textContent = username;

          div.appendChild(initial);
          div.appendChild(name);
          participantList.appendChild(div);
        });
      });
    }

    async function checkIPExists(ip) {
      const ipKey = ip.replace(/\./g, '-');
      const ipRef = ref(database, 'ips/' + ipKey);
      const snapshot = await get(ipRef);
      return snapshot.exists();
    }

    async function saveIP(ip) {
      const ipKey = ip.replace(/\./g, '-');
      const ipRef = ref(database, 'ips/' + ipKey);
      await set(ipRef, true);
    }

    async function saveParticipant(username, ip) {
      const participantsRef = ref(database, 'participants');
      const newParticipantRef = push(participantsRef);
      await set(newParticipantRef, { username, ip });
    }

    raffleForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      errorMsg.style.display = 'none';
      errorMsg.textContent = '';
      errorMsg.setAttribute('aria-invalid', 'false');
      infoMsg.textContent = '';
      infoMsg.style.animation = 'none'; // reset animation

      const username = usernameInput.value.trim();

      if (!username.match(/^[a-zA-Z0-9_]{3,20}$/)) {
        errorMsg.textContent = 'GeÃ§erli bir Roblox kullanÄ±cÄ± adÄ± girin (3-20 karakter, harf, rakam veya alt Ã§izgi).';
        errorMsg.style.display = 'block';
        errorMsg.setAttribute('aria-invalid', 'true');
        usernameInput.focus();
        return;
      }

      submitBtn.disabled = true;
      submitBtn.textContent = 'Kontrol ediliyor...';

      const ip = await getUserIP();
      if (!ip) {
        errorMsg.textContent = 'IP adresiniz alÄ±namadÄ±. Ä°nternet baÄŸlantÄ±nÄ±zÄ± kontrol edin.';
        errorMsg.style.display = 'block';
        errorMsg.setAttribute('aria-invalid', 'true');
        submitBtn.disabled = false;
        submitBtn.textContent = 'Ã‡ekiliÅŸe KatÄ±l';
        return;
      }

      const ipExists = await checkIPExists(ip);
      if (ipExists) {
        errorMsg.textContent = 'Bu IP adresiyle zaten katÄ±lÄ±m yapÄ±lmÄ±ÅŸ. Tekrar deneyemezsiniz.';
        errorMsg.style.display = 'block';
        errorMsg.setAttribute('aria-invalid', 'true');
        submitBtn.disabled = false;
        submitBtn.textContent = 'Ã‡ekiliÅŸe KatÄ±l';
        return;
      }

      try {
        await saveParticipant(username, ip);
        await saveIP(ip);

        infoMsg.textContent = 'BaÅŸarÄ±yla katÄ±ldÄ±nÄ±z! Bol ÅŸans! ðŸŽ‰';
        infoMsg.style.animation = 'none';
        void infoMsg.offsetWidth; // trigger animation reset
