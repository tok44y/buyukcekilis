<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>20 Kƒ∞≈ûƒ∞YE 1K ROBUX √áEKƒ∞Lƒ∞≈ûƒ∞</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap" rel="stylesheet" />
  <style>
    /* --- Reset & Temel --- */
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      padding: 50px 20px;
      min-height: 100vh;
      font-family: 'Montserrat', sans-serif;
      color: #e0e0e0;
      background: none;
      display: flex;
      flex-direction: column;
      align-items: center;
      overflow-x: hidden;
      position: relative;
      z-index: 0;
      user-select: none;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    /* Arkaplan GIF ve koyu katman */
    body::before {
      content: "";
      position: fixed;
      top: 0; left: 0;
      width: 100vw;
      height: 100vh;
      background: url('https://media4.giphy.com/media/v1.Y2lkPTc5MGI3NjExbDI0cHR5YnV5d25sdGRoMTZiN3lpZDFnNXAwOGlucTA5bW8zZWl3dCZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/TrVla4Z2PYEkU/giphy.gif') no-repeat center center / cover;
      z-index: -2;
      filter: brightness(1) saturate(1.2);
      animation: subtleMove 30s ease-in-out infinite alternate;
      pointer-events: none;
    }
    body::after {
      content: "";
      position: fixed;
      top: 0; left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(15,15,15,0.65);
      z-index: -1;
      pointer-events: none;
    }
    @keyframes subtleMove {
      0% { transform: scale(1) translate(0,0); }
      100% { transform: scale(1.03) translate(10px,10px); }
    }
    @keyframes floatUp {
      0% {
        opacity: 0;
        transform: translateY(15px);
      }
      50% {
        opacity: 1;
        transform: translateY(0);
      }
      100% {
        opacity: 0;
        transform: translateY(-20px);
      }
    }

    /* Ba≈ülƒ±k */
    h1 {
      font-weight: 900;
      font-size: 2.6rem;
      letter-spacing: 4px;
      color: #fafafa;
      margin-bottom: 14px;
      text-transform: uppercase;
      text-align: center;
      text-shadow:
        0 0 8px rgba(0,0,0,0.9),
        0 0 15px rgba(0,0,0,0.8);
    }
    /* Alt ba≈ülƒ±k */
    p.lead {
      font-weight: 600;
      font-size: 1.25rem;
      color: #ddd;
      max-width: 520px;
      margin: 0 auto 45px auto;
      text-align: center;
      text-shadow: 0 0 5px rgba(0,0,0,0.7);
    }

    /* Form Container */
    .container {
      background: rgba(31,31,31,0.95);
      padding: 40px 45px;
      max-width: 520px;
      width: 100%;
      border-radius: 20px;
      box-shadow:
        0 0 35px #000000ee,
        inset 0 0 15px #555555cc;
      position: relative;
      z-index: 1;
      backdrop-filter: saturate(180%) blur(10px);
      border: 1.5px solid #444;
      transition: background 0.3s ease;
    }
    .container:hover {
      background: rgba(40,40,40,0.98);
    }

    /* Label */
    label {
      display: block;
      font-weight: 700;
      margin-bottom: 14px;
      color: #f0f0f0;
      letter-spacing: 0.02em;
    }

    /* Input */
    input[type="text"] {
      width: 100%;
      padding: 18px 22px;
      font-size: 18px;
      border-radius: 16px;
      border: 2.5px solid #555;
      background: rgba(45,45,45,0.85);
      color: #eee;
      outline: none !important;
      box-shadow: inset 0 0 8px #111;
      backdrop-filter: blur(6px);
      transition: border-color 0.4s ease, box-shadow 0.4s ease, background 0.4s ease;
      font-weight: 600;
      letter-spacing: 0.03em;
    }
    input[type="text"]::placeholder {
      color: #bbb;
      font-weight: 500;
      font-style: italic;
    }
    input[type="text"]:focus {
      border-color: #ccc;
      box-shadow: 0 0 18px #ccc;
      background: rgba(60,60,60,0.95);
      color: #fafafa;
    }

    /* Button */
    button {
      margin-top: 32px;
      width: 100%;
      padding: 20px 0;
      font-size: 19px;
      font-weight: 900;
      border-radius: 20px;
      border: none;
      cursor: pointer;
      background: linear-gradient(90deg, #bbb, #eee);
      color: #121212;
      box-shadow:
        0 0 25px #ffffffdd,
        inset 0 0 10px #999;
      transition: background 0.4s ease, box-shadow 0.4s ease, color 0.4s ease;
      user-select: none;
      text-transform: uppercase;
      letter-spacing: 1.5px;
    }
    button:hover:enabled {
      background: linear-gradient(90deg, #ddd, #fff);
      box-shadow: 0 0 40px #fff;
      color: #000;
    }
    button:disabled {
      background: #555;
      cursor: not-allowed;
      box-shadow: none;
      color: #bbb;
    }

    /* Hata Mesajƒ± */
    .error {
      margin-top: 22px;
      font-weight: 700;
      color: #ff4d4d;
      text-shadow: 0 0 6px #a00;
      min-height: 28px;
      user-select: none;
      opacity: 0.95;
      transition: opacity 0.3s ease;
    }

    /* Ba≈üarƒ± / Bilgi Mesajƒ± */
    .info {
      margin-top: 22px;
      font-weight: 700;
      font-size: 16px;
      color: #4CAF50;
      user-select: none;
      text-shadow:
        0 0 10px #4CAF50cc,
        0 0 28px #4CAF50aa;
      min-height: 28px;
      pointer-events: none;
      animation: floatUp 2.5s ease forwards;
    }

    /* ≈ûartlar Kutusu */
    .terms {
      margin-top: 38px;
      background: rgba(41,41,41,0.9);
      border-radius: 20px;
      padding: 28px 30px;
      font-size: 14.3px;
      line-height: 1.6;
      color: #ddd;
      box-shadow: 0 0 18px #222222dd;
      backdrop-filter: blur(6px);
      border: 1.5px solid #444;
      user-select: none;
      letter-spacing: 0.02em;
    }
    .terms strong {
      color: #eee;
    }
    .terms ul {
      list-style: none;
      padding-left: 0;
      margin-top: 8px;
    }
    .terms li {
      margin-bottom: 14px;
      padding-left: 22px;
      position: relative;
    }
    .terms li::before {
      content: '‚úîÔ∏è';
      position: absolute;
      left: 0;
      top: 0;
      font-size: 18px;
      line-height: 1;
    }
    .terms li:nth-child(4)::before {
      content: '‚ö†Ô∏è';
    }
    .terms li:nth-child(5)::before {
      content: 'üéâ';
    }

    /* Linkler */
    .term-link {
      display: inline-block;
      margin-left: 6px;
      padding: 6px 14px;
      background: #444;
      color: #eee;
      text-decoration: none;
      border-radius: 10px;
      box-shadow: 0 0 5px #000a;
      transition: background 0.3s ease, color 0.3s ease;
      font-weight: 600;
      font-size: 13.8px;
      letter-spacing: 0.02em;
    }
    .term-link:hover {
      background: #555;
      color: #fff;
      box-shadow: 0 0 8px #eee;
    }

    /* Katƒ±lanlar Listesi */
    .participants {
      margin-top: 55px;
      max-height: 280px;
      overflow-y: auto;
      background: rgba(18,18,18,0.9);
      border-radius: 20px;
      padding: 20px 26px;
      font-size: 15px;
      box-shadow:
        0 0 30px #000000cc,
        inset 0 0 15px #222222cc;
      user-select: none;
      position: relative;
      z-index: 1;
      backdrop-filter: saturate(180%) blur(8px);
      border: 1.5px solid #333;
    }
    .participants h2 {
      margin: 0 0 20px 0;
      font-weight: 800;
      color: #eee;
      text-shadow: 0 0 5px #000000cc;
      font-size: 1.4rem;
      letter-spacing: 1.4px;
      user-select: none;
    }

    /* Katƒ±lƒ±mcƒ± Satƒ±rƒ± */
    .participant {
      display: flex;
      align-items: center;
      padding: 12px 16px;
      border-bottom: 1px solid #222;
      transition: background 0.25s ease;
    }
    .participant:hover {
      background: rgba(255,255,255,0.05);
    }
    .participant:last-child {
      border-bottom: none;
    }

    /* Avatar Ba≈ü Harfi */
    .avatar-initial {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: #3a3a3a;
      color: #eee;
      font-weight: 800;
      font-size: 17px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 18px;
      border: 1.8px solid #555;
      text-transform: uppercase;
      box-shadow: inset 0 0 6px #000000cc;
      user-select: none;
    }

    /* Scrollbar */
    .participants::-webkit-scrollbar {
      width: 8px;
    }
    .participants::-webkit-scrollbar-track {
      background: #1a1a1a;
      border-radius: 10px;
    }
    .participants::-webkit-scrollbar-thumb {
      background: #666;
      border-radius: 10px;
      box-shadow: inset 0 0 3px #000000aa;
    }

    /* Responsive */
    @media (max-width: 600px) {
      body {
        padding: 40px 15px;
      }
      .container {
        padding: 30px 25px;
      }
      h1 {
        font-size: 2.2rem;
      }
      p.lead {
        font-size: 1.1rem;
        max-width: 95%;
      }
      button {
        font-size: 17px;
        padding: 16px 0;
      }
      input[type="text"] {
        font-size: 16px;
        padding: 14px 18px;
      }
      .participants {
        max-height: 230px;
        font-size: 14px;
        padding: 16px 20px;
      }
      .avatar-initial {
        width: 32px;
        height: 32px;
        font-size: 15px;
        margin-right: 14px;
      }
    }
  </style>
</head>
<body>

  <h1>20 Kƒ∞≈ûƒ∞YE 1K ROBUX</h1>
  <p class="lead">Toplam 20 ≈üanslƒ± katƒ±lƒ±mcƒ± <strong>1000 Robux</strong> kazanacak! ≈ûimdi katƒ±l, ≈üansƒ±nƒ± g√∂ster! üöÄ</p>

  <div class="container" role="main" aria-label="√áekili≈ü Formu">
    <form id="raffleForm" autocomplete="off" novalidate>
      <label for="username">Roblox Kullanƒ±cƒ± Adƒ±nƒ±z:</label>
      <input
        type="text"
        id="username"
        name="username"
        placeholder="√ñrnek: MarksBlade"
        required
        minlength="3"
        maxlength="20"
        pattern="^[a-zA-Z0-9_]+$"
        aria-describedby="errorMsg"
        aria-invalid="false"
      />

      <div class="terms" aria-label="√áekili≈ü ≈ûartlarƒ±">
        <p><strong>√áekili≈üe katƒ±lmak i√ßin a≈üaƒüƒ±daki adƒ±mlarƒ± tamamla:</strong></p>
        <ul>
          <li>Beni takip et ‚Üí <a class="term-link" href="https://www.roblox.com/users/1665776490/profile" target="_blank" rel="noopener noreferrer">Roblox Profilim</a></li>
          <li>Gruba katƒ±l ‚Üí <a class="term-link" href="https://www.roblox.com/communities/35669821/Marks-Blade#!/about" target="_blank" rel="noopener noreferrer">Marks Blade Grubu</a></li>
          <li>Oyunu beƒüen &amp; favorilere ekle ‚Üí <a class="term-link" href="https://www.roblox.com/games/127031268866383/UPDATE" target="_blank" rel="noopener noreferrer">Roblox Oyunu</a></li>
          <li><strong>Her IP adresinden sadece 1 katƒ±lƒ±m yapƒ±labilir.</strong></li>
          <li>Toplamda <strong>20 ki≈üi</strong> rastgele se√ßilecektir.</li>
        </ul>
      </div>

      <button type="submit" id="submitBtn" aria-live="polite">√áekili≈üe Katƒ±l</button>

      <div class="error" id="errorMsg" role="alert" style="display:none;"></div>
      <div class="info" id="infoMsg" role="status" aria-live="polite"></div>
    </form>

    <div class="participants" aria-live="polite" aria-atomic="true" aria-label="Katƒ±lanlar Listesi">
      <h2>Katƒ±lanlar</h2>
      <div id="participantList">Y√ºkleniyor...</div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import { getDatabase, ref, get, set, push, onValue } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCaPAQ8sHlRdE3cuJSYokb9b-rWi_F0Ei8",
      authDomain: "marksbladebuyukcekilis.firebaseapp.com",
      databaseURL: "https://marksbladebuyukcekilis-default-rtdb.firebaseio.com",
      projectId: "marksbladebuyukcekilis",
      storageBucket: "marksbladebuyukcekilis.firebasestorage.app",
      messagingSenderId: "403809139259",
      appId: "1:403809139259:web:03b758ff825039e662ba1e",
      measurementId: "G-XNSYXYSEEW"
    };

    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);

    const raffleForm = document.getElementById('raffleForm');
    const usernameInput = document.getElementById('username');
    const submitBtn = document.getElementById('submitBtn');
    const errorMsg = document.getElementById('errorMsg');
    const infoMsg = document.getElementById('infoMsg');
    const participantList = document.getElementById('participantList');

    async function getUserIP() {
      try {
        const res = await fetch('https://api.ipify.org?format=json');
        const data = await res.json();
        return data.ip;
      } catch {
        return null;
      }
    }

    function listenParticipants() {
      const participantsRef = ref(database, 'participants');
      onValue(participantsRef, (snapshot) => {
        const data = snapshot.val();
        participantList.innerHTML = '';
        if (!data) {
          participantList.innerHTML = '<p>Hen√ºz katƒ±lƒ±m yok.</p>';
          return;
        }
        const entries = Object.values(data);
        entries.forEach(({ username }) => {
          const div = document.createElement('div');
          div.classList.add('participant');

          const initial = document.createElement('div');
          initial.classList.add('avatar-initial');
          initial.textContent = username.charAt(0).toUpperCase();

          const name = document.createElement('span');
          name.textContent = username;

          div.appendChild(initial);
          div.appendChild(name);
          participantList.appendChild(div);
        });
      });
    }

    async function checkIPExists(ip) {
      const ipKey = ip.replace(/\./g, '-');
      const ipRef = ref(database, 'ips/' + ipKey);
      const snapshot = await get(ipRef);
      return snapshot.exists();
    }

    async function saveIP(ip) {
      const ipKey = ip.replace(/\./g, '-');
      const ipRef = ref(database, 'ips/' + ipKey);
      await set(ipRef, true);
    }

    async function saveParticipant(username, ip) {
      const participantsRef = ref(database, 'participants');
      const newParticipantRef = push(participantsRef);
      await set(newParticipantRef, { username, ip });
    }

    raffleForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      errorMsg.style.display = 'none';
      errorMsg.textContent = '';
      errorMsg.setAttribute('aria-invalid', 'false');
      infoMsg.textContent = '';
      infoMsg.style.animation = 'none'; // reset animation

      const username = usernameInput.value.trim();

      if (!username.match(/^[a-zA-Z0-9_]{3,20}$/)) {
        errorMsg.textContent = 'Ge√ßerli bir Roblox kullanƒ±cƒ± adƒ± girin (3-20 karakter, harf, rakam veya alt √ßizgi).';
        errorMsg.style.display = 'block';
        errorMsg.setAttribute('aria-invalid', 'true');
        usernameInput.focus();
        return;
      }

      submitBtn.disabled = true;
      submitBtn.textContent = 'Kontrol ediliyor...';

      const ip = await getUserIP();
      if (!ip) {
        errorMsg.textContent = 'IP adresiniz alƒ±namadƒ±. ƒ∞nternet baƒülantƒ±nƒ±zƒ± kontrol edin.';
        errorMsg.style.display = 'block';
        errorMsg.setAttribute('aria-invalid', 'true');
        submitBtn.disabled = false;
        submitBtn.textContent = '√áekili≈üe Katƒ±l';
        return;
      }

      const ipExists = await checkIPExists(ip);
      if (ipExists) {
        errorMsg.textContent = 'Bu IP adresiyle zaten katƒ±lƒ±m yapƒ±lmƒ±≈ü. Tekrar deneyemezsiniz.';
        errorMsg.style.display = 'block';
        errorMsg.setAttribute('aria-invalid', 'true');
        submitBtn.disabled = false;
        submitBtn.textContent = '√áekili≈üe Katƒ±l';
        return;
      }

      try {
        await saveParticipant(username, ip);
        await saveIP(ip);

        infoMsg.textContent = 'Ba≈üarƒ±yla katƒ±ldƒ±nƒ±z! Bol ≈üans! üéâ';
        infoMsg.style.animation = 'none';
        void infoMsg.offsetWidth; // trigger animasyon reset
        infoMsg.style.animation = 'floatUp 2.5s ease forwards';

        raffleForm.reset();
        usernameInput.focus();
      } catch {
        errorMsg.textContent = 'Kayƒ±t sƒ±rasƒ±nda hata olu≈ütu. L√ºtfen tekrar deneyin.';
        errorMsg.style.display = 'block';
        errorMsg.setAttribute('aria-invalid', 'true');
      }

      submitBtn.disabled = false;
      submitBtn.textContent = '√áekili≈üe Katƒ±l';
    });

    listenParticipants();
  </script>

</body>
</html>
